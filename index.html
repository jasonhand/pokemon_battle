<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pok√©mon Game Theory Battle Arena</title>
    <style>
        :root {
            --mx: 50%;
            --my: 50%;
            --s: 1;
            --o: 0;
            --tx: 0px;
            --ty: 0px;
            --rx: 0deg;
            --ry: 0deg;
            --pos: 50% 50%;
            --posx: 50%;
            --posy: 50%;
            --hyp: 0;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .game-header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .game-title {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #FFD700, #FFA500);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .game-subtitle {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .progress-container {
            background: rgba(255,255,255,0.2);
            border-radius: 20px;
            padding: 10px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: rgba(255,255,255,0.3);
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 10px;
        }

        .round-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: white;
            font-weight: bold;
            margin-top: 10px;
        }

        .players-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .player-card {
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255,255,255,0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .player-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .player-card.human {
            border-color: #4CAF50;
            box-shadow: 0 0 20px rgba(76,175,80,0.3);
        }

        .player-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .player-name {
            font-size: 1.3em;
            font-weight: bold;
            color: white;
        }

        .player-score {
            font-size: 1.5em;
            font-weight: bold;
            color: #FFD700;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }

        .pokemon-card {
            width: 100%;
            height: calc(100vh - 200px);
            min-height: 400px;
            position: relative;
            overflow: hidden;
            margin-bottom: 15px;
            cursor: pointer;
            transition: transform 0.3s ease;
            border-radius: 4.55% / 3.5%;
            transform-style: preserve-3d;
            perspective: 600px;
        }

        .pokemon-card:hover {
            transform: scale(1.05);
        }

        .pokemon-card.flipped {
            transform: rotateY(180deg);
        }

        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: rgba(255,255,255,0.1);
            border-radius: 4.55% / 3.5%;
            overflow: hidden;
            transform-style: preserve-3d;
            box-shadow: 0px 10px 20px -5px black;
            transition: box-shadow 0.4s ease, outline 0.2s ease;
        }

        .pokemon-card:hover .card-inner {
            box-shadow: 0 0 10px 0px #69d1e9, 0 0 10px 0px #69d1e9, 0 0 30px 0px #69d1e9;
        }

        .pokemon-emoji {
            font-size: 4em;
            margin-bottom: 10px;
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.3));
        }

        .pokemon-image-container {
            flex: 1;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
        }

        .pokemon-sprite {
            width: 120%;
            height: 120%;
            max-width: none;
            max-height: none;
            object-fit: cover;
            filter: drop-shadow(4px 4px 8px rgba(0,0,0,0.4));
            background: transparent;
            border-radius: 4.55% / 3.5%;
            padding: 0;
            image-rendering: optimizeQuality;
            transform-style: preserve-3d;
            transform-origin: center;
            animation: kenBurns 8s ease-in-out infinite;
        }

        .pokemon-info {
            position: absolute;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: rgba(0,0,0,0.7);
            padding: 15px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
            z-index: 10;
        }

        /* Ken Burns Effect Container */
        .card-inner::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(
                133deg,
                transparent 0%,
                rgba(255, 255, 255, 0.05) 30%,
                rgba(255, 255, 255, 0.1) 50%,
                rgba(255, 255, 255, 0.05) 70%,
                transparent 100%
            );
            pointer-events: none;
            z-index: 5;
            animation: subtleShine 4s ease-in-out infinite;
            opacity: 0.3;
        }



        @keyframes kenBurns {
            0% {
                transform: scale(1) translate(0, 0);
            }
            25% {
                transform: scale(1.1) translate(-2%, -1%);
            }
            50% {
                transform: scale(1.05) translate(1%, -2%);
            }
            75% {
                transform: scale(1.15) translate(-1%, 1%);
            }
            100% {
                transform: scale(1) translate(0, 0);
            }
        }

        @keyframes subtleShine {
            0%, 100% {
                opacity: 0.3;
                transform: translateX(-100%) translateY(-100%) rotate(45deg);
            }
            50% {
                opacity: 0.5;
                transform: translateX(100%) translateY(100%) rotate(45deg);
            }
        }

        .pokemon-name {
            font-size: 1.1em;
            font-weight: bold;
            color: white;
            text-transform: capitalize;
            margin-bottom: 5px;
        }

        .pokemon-types {
            display: flex;
            gap: 5px;
            margin-bottom: 10px;
        }

        .type-badge {
            background: rgba(255,255,255,0.3);
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.8em;
            color: white;
            text-transform: capitalize;
        }

        .pokemon-points {
            font-size: 1.2em;
            font-weight: bold;
            color: #FFD700;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        .decision-area {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .decision-btn {
            flex: 1;
            padding: 12px 20px;
            border: none;
            border-radius: 25px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .cooperate-btn {
            background: linear-gradient(45deg, #4CAF50, #8BC34A);
            color: white;
        }

        .cooperate-btn:hover {
            background: linear-gradient(45deg, #45a049, #7cb342);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76,175,80,0.4);
        }

        .defect-btn {
            background: linear-gradient(45deg, #f44336, #ff5722);
            color: white;
        }

        .defect-btn:hover {
            background: linear-gradient(45deg, #da190b, #e64a19);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(244,67,54,0.4);
        }

        .decision-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .ai-thinking {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 10px;
            margin-top: 10px;
            font-size: 0.9em;
            color: white;
            font-style: italic;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .thinking-dots {
            display: inline-block;
            width: 20px;
            text-align: left;
        }

        .thinking-dots:after {
            content: '';
            animation: dots 1.5s infinite;
        }

        @keyframes dots {
            0% { content: ''; }
            25% { content: '.'; }
            50% { content: '..'; }
            75% { content: '...'; }
            100% { content: ''; }
        }

        .game-controls {
            text-align: center;
            margin-top: 30px;
        }

        .new-game-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.2em;
            font-weight: bold;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .new-game-btn:hover {
            background: linear-gradient(45deg, #5a67d8, #6b46c1);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102,126,234,0.4);
        }

        .results-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .results-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            color: white;
            max-width: 500px;
            width: 90%;
        }

        .results-title {
            font-size: 2em;
            margin-bottom: 20px;
            color: #FFD700;
        }

        .final-scores {
            margin: 20px 0;
        }

        .final-score {
            font-size: 1.2em;
            margin: 10px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .winner {
            color: #FFD700;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .loading {
            text-align: center;
            color: white;
            font-size: 1.2em;
            margin: 20px 0;
        }

        .pokemon-card.revealed {
            animation: cardReveal 0.5s ease;
        }

        @keyframes cardReveal {
            0% {
                transform: rotateY(90deg);
                opacity: 0;
            }
            100% {
                transform: rotateY(0deg);
                opacity: 1;
            }
        }

        .score-animation {
            animation: scoreBoost 0.5s ease;
        }

        @keyframes scoreBoost {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); color: #FFD700; }
            100% { transform: scale(1); }
        }

        .hidden {
            display: none;
        }

        .round-result {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 15px;
            margin: 15px 0;
            backdrop-filter: blur(10px);
        }

        .round-result h3 {
            color: #FFD700;
            margin-bottom: 10px;
        }

        .decision-display {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .decision-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .decision-icon {
            width: 20px;
            height: 20px;
            border-radius: 50%;
        }

        .cooperate-icon {
            background: #4CAF50;
        }

        .defect-icon {
            background: #f44336;
        }

        @media (max-width: 768px) {
            .players-container {
                grid-template-columns: 1fr;
            }
            
            .game-title {
                font-size: 2em;
            }
            
            .pokemon-card {
                height: calc(100vh - 250px);
                min-height: 300px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="game-header">
            <h1 class="game-title">üéÆ Pok√©mon Game Theory Battle Arena</h1>
            <p class="game-subtitle">Strategic card battles with cooperation and betrayal!</p>
        </div>

        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="round-info">
                <span>Round <span id="currentRound">1</span> of 8</span>
                <span>Time to choose: <span id="timer">30</span>s</span>
            </div>
        </div>

        <div class="players-container">
            <div class="player-card human" id="humanPlayer">
                <div class="player-header">
                    <span class="player-name">You</span>
                    <span class="player-score" id="humanScore">0</span>
                </div>
                <div class="pokemon-card" id="humanCard">
                    <div class="card-inner">
                        <div class="loading">Drawing your card...</div>
                    </div>
                </div>
                <div class="decision-area">
                    <button class="decision-btn cooperate-btn" id="cooperateBtn">ü§ù Cooperate</button>
                    <button class="decision-btn defect-btn" id="defectBtn">‚öîÔ∏è Defect</button>
                </div>
            </div>

            <div class="player-card" id="trustyPlayer">
                <div class="player-header">
                    <span class="player-name">Trusty AI</span>
                    <span class="player-score" id="trustyScore">0</span>
                </div>
                <div class="pokemon-card" id="trustyCard">
                    <div class="card-inner">
                        <div class="loading">Drawing card...</div>
                    </div>
                </div>
                <div class="ai-thinking" id="trustyThinking">
                    <span class="thinking-dots"></span>
                </div>
            </div>

            <div class="player-card" id="riskyPlayer">
                <div class="player-header">
                    <span class="player-name">Risky AI</span>
                    <span class="player-score" id="riskyScore">0</span>
                </div>
                <div class="pokemon-card" id="riskyCard">
                    <div class="card-inner">
                        <div class="loading">Drawing card...</div>
                    </div>
                </div>
                <div class="ai-thinking" id="riskyThinking">
                    <span class="thinking-dots"></span>
                </div>
            </div>
        </div>

        <div id="roundResult" class="round-result hidden">
            <h3>Round Results</h3>
            <div class="decision-display" id="decisionDisplay"></div>
            <div id="roundExplanation"></div>
        </div>

        <div class="game-controls">
            <button class="new-game-btn" id="newGameBtn">üé≤ New Game</button>
        </div>
    </div>

    <div class="results-modal" id="resultsModal">
        <div class="results-content">
            <h2 class="results-title">üèÜ Game Complete!</h2>
            <div class="final-scores" id="finalScores"></div>
            <button class="new-game-btn" id="playAgainBtn">üéÆ Play Again</button>
        </div>
    </div>

    <script>
        class PokemonGameTheory {
            constructor() {
                this.currentRound = 1;
                this.maxRounds = 8;
                this.players = {
                    human: { score: 0, decision: null, pokemon: null },
                    trusty: { score: 0, decision: null, pokemon: null },
                    risky: { score: 0, decision: null, pokemon: null }
                };
                this.gameHistory = [];
                this.timer = 30;
                this.timerInterval = null;
                this.pokemonCache = new Map();
                
                this.initializeGame();
                this.setupEventListeners();
            }

            initializeGame() {
                this.updateUI();
                this.startRound();
            }

            setupEventListeners() {
                document.getElementById('cooperateBtn').addEventListener('click', () => this.makeDecision('cooperate'));
                document.getElementById('defectBtn').addEventListener('click', () => this.makeDecision('defect'));
                document.getElementById('newGameBtn').addEventListener('click', () => this.resetGame());
                document.getElementById('playAgainBtn').addEventListener('click', () => this.resetGame());
            }

            async startRound() {
                this.resetRoundState();
                this.updateProgressBar();
                this.startTimer();
                
                // Fetch Pokemon for all players
                await Promise.all([
                    this.fetchPokemonForPlayer('human'),
                    this.fetchPokemonForPlayer('trusty'),
                    this.fetchPokemonForPlayer('risky')
                ]);

                this.showAIThinking();
            }

            resetRoundState() {
                this.players.human.decision = null;
                this.players.trusty.decision = null;
                this.players.risky.decision = null;
                
                document.getElementById('cooperateBtn').disabled = false;
                document.getElementById('defectBtn').disabled = false;
                document.getElementById('roundResult').classList.add('hidden');
            }

            startTimer() {
                this.timer = 30;
                this.timerInterval = setInterval(() => {
                    this.timer--;
                    document.getElementById('timer').textContent = this.timer;
                    
                    if (this.timer <= 0) {
                        clearInterval(this.timerInterval);
                        if (!this.players.human.decision) {
                            this.makeDecision('cooperate'); // Default to cooperate
                        }
                    }
                }, 1000);
            }

            async fetchPokemonForPlayer(player) {
                // Use completely local Pokemon data to avoid CORS issues
                const pokemon = this.getRandomPokemon();
                this.players[player].pokemon = pokemon;
                this.displayPokemonCard(player);
            }

            getRandomPokemon() {
                // Complete local Pokemon database with actual image URLs
                const pokemonDatabase = [
                    { name: 'Pikachu', imageUrl: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/25.png', emoji: '‚ö°', types: ['electric'], basePoints: 35, color: '#F7D02C' },
                    { name: 'Charizard', imageUrl: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/6.png', emoji: 'üî•', types: ['fire', 'flying'], basePoints: 78, color: '#EE8130' },
                    { name: 'Blastoise', imageUrl: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/9.png', emoji: 'üíß', types: ['water'], basePoints: 79, color: '#6390F0' },
                    { name: 'Venusaur', imageUrl: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/3.png', emoji: 'üåø', types: ['grass', 'poison'], basePoints: 80, color: '#7AC74C' },
                    { name: 'Alakazam', imageUrl: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/65.png', emoji: 'üîÆ', types: ['psychic'], basePoints: 55, color: '#F95587' },
                    { name: 'Machamp', imageUrl: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/68.png', emoji: 'üí™', types: ['fighting'], basePoints: 90, color: '#C22E28' },
                    { name: 'Gengar', imageUrl: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/94.png', emoji: 'üëª', types: ['ghost', 'poison'], basePoints: 60, color: '#735797' },
                    { name: 'Dragonite', imageUrl: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/149.png', emoji: 'üêâ', types: ['dragon', 'flying'], basePoints: 91, color: '#6F35FC' },
                    { name: 'Mewtwo', imageUrl: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/150.png', emoji: 'üß†', types: ['psychic'], basePoints: 106, color: '#F95587' },
                    { name: 'Mew', imageUrl: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/151.png', emoji: '‚ú®', types: ['psychic'], basePoints: 100, color: '#F95587' },
                    { name: 'Gyarados', imageUrl: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/130.png', emoji: 'üåä', types: ['water', 'flying'], basePoints: 81, color: '#6390F0' },
                    { name: 'Lapras', imageUrl: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/131.png', emoji: 'üö¢', types: ['water', 'ice'], basePoints: 86, color: '#96D9D6' },
                    { name: 'Eevee', imageUrl: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/133.png', emoji: 'ü¶ä', types: ['normal'], basePoints: 55, color: '#A8A878' },
                    { name: 'Snorlax', imageUrl: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/143.png', emoji: 'üò¥', types: ['normal'], basePoints: 82, color: '#A8A878' },
                    { name: 'Articuno', imageUrl: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/144.png', emoji: 'üßä', types: ['ice', 'flying'], basePoints: 95, color: '#96D9D6' },
                    { name: 'Zapdos', imageUrl: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/145.png', emoji: '‚ö°', types: ['electric', 'flying'], basePoints: 90, color: '#F7D02C' },
                    { name: 'Moltres', imageUrl: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/146.png', emoji: 'üî•', types: ['fire', 'flying'], basePoints: 90, color: '#EE8130' },
                    { name: 'Raichu', imageUrl: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/26.png', emoji: '‚ö°', types: ['electric'], basePoints: 60, color: '#F7D02C' },
                    { name: 'Arcanine', imageUrl: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/59.png', emoji: 'üêï', types: ['fire'], basePoints: 75, color: '#EE8130' },
                    { name: 'Rapidash', imageUrl: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/78.png', emoji: 'ü¶Ñ', types: ['fire'], basePoints: 63, color: '#EE8130' },
                    { name: 'Slowpoke', imageUrl: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/79.png', emoji: 'üòµ', types: ['water', 'psychic'], basePoints: 40, color: '#F95587' },
                    { name: 'Magnemite', imageUrl: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/81.png', emoji: 'üß≤', types: ['electric', 'steel'], basePoints: 35, color: '#B7B7CE' },
                    { name: 'Psyduck', imageUrl: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/54.png', emoji: 'ü¶Ü', types: ['water'], basePoints: 44, color: '#6390F0' },
                    { name: 'Growlithe', imageUrl: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/58.png', emoji: 'üê∂', types: ['fire'], basePoints: 45, color: '#EE8130' },
                    { name: 'Abra', imageUrl: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/63.png', emoji: 'üé≠', types: ['psychic'], basePoints: 25, color: '#F95587' },
                    { name: 'Kadabra', imageUrl: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/64.png', emoji: 'üîÆ', types: ['psychic'], basePoints: 40, color: '#F95587' },
                    { name: 'Machop', imageUrl: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/66.png', emoji: 'üí™', types: ['fighting'], basePoints: 35, color: '#C22E28' },
                    { name: 'Geodude', imageUrl: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/74.png', emoji: 'ü™®', types: ['rock', 'ground'], basePoints: 40, color: '#B6A136' },
                    { name: 'Ponyta', imageUrl: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/77.png', emoji: 'üêé', types: ['fire'], basePoints: 41, color: '#EE8130' },
                    { name: 'Magikarp', imageUrl: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/129.png', emoji: 'üêü', types: ['water'], basePoints: 20, color: '#6390F0' },
                    { name: 'Ditto', imageUrl: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/132.png', emoji: 'ü´ß', types: ['normal'], basePoints: 48, color: '#A8A878' },
                    { name: 'Vaporeon', imageUrl: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/134.png', emoji: 'üíô', types: ['water'], basePoints: 65, color: '#6390F0' },
                    { name: 'Jolteon', imageUrl: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/135.png', emoji: 'üíõ', types: ['electric'], basePoints: 65, color: '#F7D02C' },
                    { name: 'Flareon', imageUrl: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/136.png', emoji: 'üß°', types: ['fire'], basePoints: 65, color: '#EE8130' },
                    { name: 'Squirtle', imageUrl: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/7.png', emoji: 'üê¢', types: ['water'], basePoints: 44, color: '#6390F0' },
                    { name: 'Wartortle', imageUrl: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/8.png', emoji: 'üê¢', types: ['water'], basePoints: 59, color: '#6390F0' },
                    { name: 'Charmander', imageUrl: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/4.png', emoji: 'ü¶é', types: ['fire'], basePoints: 39, color: '#EE8130' },
                    { name: 'Charmeleon', imageUrl: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/5.png', emoji: 'ü¶é', types: ['fire'], basePoints: 58, color: '#EE8130' },
                    { name: 'Bulbasaur', imageUrl: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/1.png', emoji: 'üå±', types: ['grass', 'poison'], basePoints: 45, color: '#7AC74C' },
                    { name: 'Ivysaur', imageUrl: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/2.png', emoji: 'üåø', types: ['grass', 'poison'], basePoints: 60, color: '#7AC74C' },
                    { name: 'Butterfree', imageUrl: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/12.png', emoji: 'ü¶ã', types: ['bug', 'flying'], basePoints: 60, color: '#A6B91A' },
                    { name: 'Beedrill', imageUrl: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/15.png', emoji: 'üêù', types: ['bug', 'poison'], basePoints: 65, color: '#A6B91A' },
                    { name: 'Pidgeot', imageUrl: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/18.png', emoji: 'ü¶Ö', types: ['normal', 'flying'], basePoints: 83, color: '#A8A878' },
                    { name: 'Fearow', imageUrl: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/22.png', emoji: 'üê¶', types: ['normal', 'flying'], basePoints: 65, color: '#A8A878' },
                    { name: 'Sandslash', imageUrl: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/28.png', emoji: 'ü¶î', types: ['ground'], basePoints: 75, color: '#E2BF65' },
                    { name: 'Nidoking', imageUrl: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/34.png', emoji: 'üëë', types: ['poison', 'ground'], basePoints: 81, color: '#A33EA1' },
                    { name: 'Clefairy', imageUrl: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/35.png', emoji: 'üåô', types: ['fairy'], basePoints: 48, color: '#D685AD' },
                    { name: 'Ninetales', imageUrl: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/38.png', emoji: 'ü¶ä', types: ['fire'], basePoints: 73, color: '#EE8130' },
                    { name: 'Jigglypuff', imageUrl: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/39.png', emoji: 'üéà', types: ['normal', 'fairy'], basePoints: 45, color: '#D685AD' },
                    { name: 'Wigglytuff', imageUrl: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/40.png', emoji: 'üéà', types: ['normal', 'fairy'], basePoints: 70, color: '#D685AD' },
                    { name: 'Vileplume', imageUrl: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/45.png', emoji: 'üå∏', types: ['grass', 'poison'], basePoints: 75, color: '#7AC74C' }
                ];
                
                const randomPokemon = pokemonDatabase[Math.floor(Math.random() * pokemonDatabase.length)];
                
                // Add some randomness to points (¬±10%)
                const variance = Math.floor(randomPokemon.basePoints * 0.1);
                const randomVariance = Math.floor(Math.random() * (variance * 2 + 1)) - variance;
                const finalPoints = Math.max(10, randomPokemon.basePoints + randomVariance);
                
                return {
                    ...randomPokemon,
                    points: finalPoints,
                    id: Math.floor(Math.random() * 1000) + 1
                };
            }

            getFallbackSprite(id) {
                // No longer needed - using emoji system
                return null;
            }

            getFallbackPokemon() {
                // No longer needed - using local database
                return this.getRandomPokemon();
            }

            calculatePoints(data) {
                // No longer needed - points are pre-calculated in local database
                return data.basePoints || 30;
            }

            displayPokemonCard(player) {
                const card = document.getElementById(`${player}Card`);
                const pokemon = this.players[player].pokemon;
                
                card.innerHTML = `
                    <div class="card-inner" style="background: linear-gradient(135deg, ${pokemon.color}40, ${pokemon.color}80);">
                        <div class="pokemon-image-container">
                            <img src="${pokemon.imageUrl}" alt="${pokemon.name}" class="pokemon-sprite" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                            <div class="pokemon-emoji" style="display: none;">${pokemon.emoji || 'üé¥'}</div>
                        </div>
                        <div class="pokemon-info">
                            <div class="pokemon-name">${pokemon.name}</div>
                            <div class="pokemon-types">
                                ${pokemon.types.map(type => `<span class="type-badge" style="background: ${this.getTypeColor(type)}">${type}</span>`).join('')}
                            </div>
                            <div class="pokemon-points">${pokemon.points} points</div>
                        </div>
                    </div>
                `;
                
                card.classList.add('revealed');
                setTimeout(() => card.classList.remove('revealed'), 500);
            }

            getTypeColor(type) {
                const typeColors = {
                    normal: '#A8A878',
                    fire: '#EE8130',
                    water: '#6390F0',
                    electric: '#F7D02C',
                    grass: '#7AC74C',
                    ice: '#96D9D6',
                    fighting: '#C22E28',
                    poison: '#A33EA1',
                    ground: '#E2BF65',
                    flying: '#A98FF3',
                    psychic: '#F95587',
                    bug: '#A6B91A',
                    rock: '#B6A136',
                    ghost: '#735797',
                    dragon: '#6F35FC',
                    dark: '#705746',
                    steel: '#B7B7CE',
                    fairy: '#D685AD'
                };
                return typeColors[type] || '#68A090';
            }

            showAIThinking() {
                const trustyThoughts = [
                    "I usually like to cooperate...",
                    "Trust builds stronger bonds!",
                    "Maybe we can all win together?",
                    "Cooperation feels right to me.",
                    "I believe in working together!"
                ];
                
                const riskyThoughts = [
                    "Should I take a risk here?",
                    "Sometimes you have to be bold...",
                    "What if I defect this time?",
                    "Playing it safe... or not?",
                    "Fortune favors the bold!"
                ];

                document.getElementById('trustyThinking').innerHTML = 
                    trustyThoughts[Math.floor(Math.random() * trustyThoughts.length)] + 
                    ' <span class="thinking-dots"></span>';
                
                document.getElementById('riskyThinking').innerHTML = 
                    riskyThoughts[Math.floor(Math.random() * riskyThoughts.length)] + 
                    ' <span class="thinking-dots"></span>';
            }

            makeDecision(decision) {
                if (this.players.human.decision) return;
                
                this.players.human.decision = decision;
                document.getElementById('cooperateBtn').disabled = true;
                document.getElementById('defectBtn').disabled = true;
                
                clearInterval(this.timerInterval);
                
                // Make AI decisions
                this.makeAIDecisions();
                
                // Process round after a short delay
                setTimeout(() => this.processRound(), 1000);
            }

            makeAIDecisions() {
                // Trusty AI logic (70% cooperation, adapts to player)
                const humanCooperationRate = this.gameHistory.filter(h => h.human === 'cooperate').length / Math.max(1, this.gameHistory.length);
                const trustyCooperationChance = 0.7 + (humanCooperationRate * 0.2);
                this.players.trusty.decision = Math.random() < trustyCooperationChance ? 'cooperate' : 'defect';
                
                // Risky AI logic (40% cooperation, slightly strategic)
                const riskyCooperationChance = 0.4 - (this.currentRound / 20); // Gets riskier over time
                this.players.risky.decision = Math.random() < riskyCooperationChance ? 'cooperate' : 'defect';
            }

            processRound() {
                const decisions = {
                    human: this.players.human.decision,
                    trusty: this.players.trusty.decision,
                    risky: this.players.risky.decision
                };

                this.gameHistory.push(decisions);

                // Calculate scores based on game theory
                const cooperators = Object.values(decisions).filter(d => d === 'cooperate').length;
                const defectors = 3 - cooperators;

                Object.keys(this.players).forEach(player => {
                    const basePoints = this.players[player].pokemon.points;
                    let finalPoints = basePoints;

                    if (cooperators === 3) {
                        // All cooperate: +50% bonus
                        finalPoints = Math.floor(basePoints * 1.5);
                    } else if (cooperators === 0) {
                        // All defect: -25% penalty
                        finalPoints = Math.floor(basePoints * 0.75);
                    } else {
                        // Mixed: cooperators get base, defectors get +25% but risk penalties
                        if (decisions[player] === 'cooperate') {
                            finalPoints = basePoints;
                        } else {
                            finalPoints = Math.floor(basePoints * 1.25);
                        }
                    }

                    this.players[player].score += finalPoints;
                });

                this.displayRoundResult(decisions, cooperators);
                this.updateScores();
                
                if (this.currentRound >= this.maxRounds) {
                    setTimeout(() => this.endGame(), 3000);
                } else {
                    this.currentRound++;
                    setTimeout(() => this.startRound(), 3000);
                }
            }

            displayRoundResult(decisions, cooperators) {
                const resultDiv = document.getElementById('roundResult');
                const decisionDisplay = document.getElementById('decisionDisplay');
                const explanation = document.getElementById('roundExplanation');

                decisionDisplay.innerHTML = `
                    <div class="decision-item">
                        <div class="decision-icon ${decisions.human === 'cooperate' ? 'cooperate-icon' : 'defect-icon'}"></div>
                        <span>You: ${decisions.human}</span>
                    </div>
                    <div class="decision-item">
                        <div class="decision-icon ${decisions.trusty === 'cooperate' ? 'cooperate-icon' : 'defect-icon'}"></div>
                        <span>Trusty: ${decisions.trusty}</span>
                    </div>
                    <div class="decision-item">
                        <div class="decision-icon ${decisions.risky === 'cooperate' ? 'cooperate-icon' : 'defect-icon'}"></div>
                        <span>Risky: ${decisions.risky}</span>
                    </div>
                `;

                let explanationText = "";
                if (cooperators === 3) {
                    explanationText = "ü§ù Everyone cooperated! All players get +50% bonus points!";
                } else if (cooperators === 0) {
                    explanationText = "‚öîÔ∏è Everyone defected! All players lose 25% points as penalty!";
                } else {
                    explanationText = "ü§î Mixed decisions! Cooperators get base points, defectors get +25% but risk future penalties!";
                }

                explanation.innerHTML = explanationText;
                resultDiv.classList.remove('hidden');
            }

            updateScores() {
                ['human', 'trusty', 'risky'].forEach(player => {
                    const scoreElement = document.getElementById(`${player}Score`);
                    scoreElement.textContent = this.players[player].score;
                    scoreElement.classList.add('score-animation');
                    setTimeout(() => scoreElement.classList.remove('score-animation'), 500);
                });
            }

            updateProgressBar() {
                const progress = (this.currentRound / this.maxRounds) * 100;
                document.getElementById('progressFill').style.width = `${progress}%`;
                document.getElementById('currentRound').textContent = this.currentRound;
            }

            updateUI() {
                this.updateScores();
                this.updateProgressBar();
            }

            endGame() {
                const scores = [
                    { name: 'You', score: this.players.human.score },
                    { name: 'Trusty AI', score: this.players.trusty.score },
                    { name: 'Risky AI', score: this.players.risky.score }
                ].sort((a, b) => b.score - a.score);

                const finalScoresDiv = document.getElementById('finalScores');
                finalScoresDiv.innerHTML = scores.map((player, index) => `
                    <div class="final-score ${index === 0 ? 'winner' : ''}">
                        <span>${index + 1}. ${player.name}</span>
                        <span>${player.score} points</span>
                    </div>
                `).join('');

                document.getElementById('resultsModal').style.display = 'flex';
            }

            resetGame() {
                this.currentRound = 1;
                this.players = {
                    human: { score: 0, decision: null, pokemon: null },
                    trusty: { score: 0, decision: null, pokemon: null },
                    risky: { score: 0, decision: null, pokemon: null }
                };
                this.gameHistory = [];
                
                document.getElementById('resultsModal').style.display = 'none';
                document.getElementById('roundResult').classList.add('hidden');
                
                this.initializeGame();
            }
        }

        // Start the game when page loads
        window.addEventListener('load', () => {
            new PokemonGameTheory();
            setupHolographicEffects();
        });

        // Setup Ken Burns card effects
        function setupHolographicEffects() {
            const cards = document.querySelectorAll('.pokemon-card');
            
            cards.forEach((card, index) => {
                // Add variety to Ken Burns animations
                const sprite = card.querySelector('.pokemon-sprite');
                if (sprite) {
                    // Stagger animations and add variety
                    sprite.style.animationDelay = `${index * 0.5}s`;
                    
                    // Randomize animation duration slightly for variety
                    const duration = 8 + (Math.random() * 2 - 1); // 7-9 seconds
                    sprite.style.animationDuration = `${duration}s`;
                }

                // Keep subtle hover effect
                card.addEventListener('mouseenter', () => {
                    const sprite = card.querySelector('.pokemon-sprite');
                    if (sprite) {
                        sprite.style.animationPlayState = 'paused';
                    }
                });

                card.addEventListener('mouseleave', () => {
                    const sprite = card.querySelector('.pokemon-sprite');
                    if (sprite) {
                        sprite.style.animationPlayState = 'running';
                    }
                });
            });
        }
    </script>
</body>
</html>